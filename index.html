<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de investimentos</title>
    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body onload="buscarTaxas()">
    <header><h1>Calculadora de investimentos</h1></header>
    <main>
    <div class="container">
        <div class="texto"><p>Insira os valores</p></div>
            <div class="input-grafico">
                <div class="inputs">
                    <div class="inputs-1">
                        <div>
                            <label for="inicial">Investimento inicial</label>
                            <input type="number" id="inicial" name="inicial" onclick="this.select()" value="0.00" min="0" step="1" oninput="calcularRendimento()">
                        </div>
                        <div>
                            <label for="mensal">Aportes mensais</label>
                            <input type="number" id="mensal" name="mensal" onclick="this.select()" value="0.00" min="0" step="1" oninput="calcularRendimento()">
                        </div>
                        <div>
                            <label for="duracao">Periodo de aplicação</label>
                            <input type="number" id="duracao" name="duracao" onclick="this.select()" min="0" value="0" oninput="calcularRendimento()">
                            <select id="periodo-unidade" name="periodo-unidade" onchange="calcularRendimento()">
                                <option value="meses">Meses</option>
                                <option value="anos">Anos</option>
                            </select>
                        </div>
                    </div>
                    <div class="inputs-2">
                        <div><label for="selic">Selic efetiva (a.a.)</label>
                            <input type="number" id="selic" name="selic" onclick="this.select()" value="0.00" min="0" step="1" oninput="calcularRendimento()"></div>
                        <div><label for="cdi">CDI (a.a.)</label>
                            <input type="number" id="cdi" name="cdi" onclick="this.select()" value="0.00" min="0" step="1" oninput="calcularRendimento()"></div>
                        <div><label for="ipca">IPCA (a.m.)</label>
                            <input type="number" id="ipca" name="ipca" onclick="this.select()" value="0.00" min="0" step="1" oninput="calcularRendimento()"></div>
                        <div><label for="tr">TR (a.m.)</label>
                            <input type="number" id="tr" name="tr" onclick="this.select()" value="0.00" min="0" step="1" oninput="calcularRendimento()"></div>
                    </div>
                    <div class="inputs-3">
                        <div class="inputs-3-item"><label for="poupanca">Rentabilidade da Poupança (a.m.)</label>
                            <input type="number" id="poupanca" name="poupanca" onclick="this.select()" value="0.00" min="0" step="1" oninput="calcularRendimento()"></div>
                        <div class="inputs-3-item" id="CDB-item"><label for="CDB">Rentabilidade do CDB(% do CDI)</label>
                            <input type="number" id="CDB" name="CDB" onclick="this.select()" value="0.00" min="0" step="1" oninput="calcularRendimento()"></div>
                        <div class="inputs-3-item"><label for="tesouro-ipca">Juro real do Tesouro IPCA+(a.m.)</label>
                            <input type="number" id="tesouro-ipca" name="tesouro-ipca" onclick="this.select()" value="0.00" min="0" step="1" oninput="calcularRendimento()"></div>
                        <div class="inputs-3-item"><label for="tesourDrefix">Juro nominal do Tesouro Prefixado (a.a.)</label>
                            <input type="number" id="tesouroPrefix" name="tesouroPrefix" onclick="this.select()" value="0.00" min="0" step="1" oninput="calcularRendimento()"></div>
                        <div class="inputs-3-item"><label for="admDi">Taxa de administração do fundo DI(a.a.)</label>
                            <input type="number" id="admDi" name="admDi" onclick="this.select()" value="0.00" min="0" step="1" oninput="calcularRendimento()"></div>
                        <div class="inputs-3-item"><label for="rentDi">Rentabilidade do Fundo DI(% do CDI)</label>
                            <input type="number" id="rentDi" name="rentDi" onclick="this.select()" value="0.00" min="0" step="1" oninput="calcularRendimento()"></div>
                    </div>
                </div>
                <div class="grafico">
                    <div class="resultado">
                        <p>Resultado estimado:</p>
                        <canvas id="graficoRendimento" style="width: 300px; height: 300px;"></canvas>
                    <script>
let grafico;

async function buscarTaxas() {
    try {
        const urls = {
            selic: "https://api.bcb.gov.br/dados/serie/bcdata.sgs.1178/dados?formato=json",
            cdi: "https://api.bcb.gov.br/dados/serie/bcdata.sgs.4389/dados?formato=json",
            ipca: "https://api.bcb.gov.br/dados/serie/bcdata.sgs.11426/dados?formato=json",
            tesouroIpca: "https://api.bcb.gov.br/dados/serie/bcdata.sgs.433/dados?formato=json",
            tr: "https://api.bcb.gov.br/dados/serie/bcdata.sgs.226/dados?formato=json",
            poupanca: "https://api.bcb.gov.br/dados/serie/bcdata.sgs.195/dados?formato=json"
        }

        async function fetchTaxa(url) {
            const response = await fetch(url)
            const data = await response.json()
            const valor = data[data.length - 1]?.valor
            return parseFloat(valor)
        }

        const selic = await fetchTaxa(urls.selic)
        document.getElementById('selic').value = isNaN(selic) ? "N/A" : selic.toFixed(2)
        const cdi = await fetchTaxa(urls.cdi)
        document.getElementById('cdi').value = isNaN(cdi) ? "N/A" : cdi.toFixed(2)
        const ipca = await fetchTaxa(urls.ipca)
        document.getElementById('ipca').value = isNaN(ipca) ? "N/A" : ipca.toFixed(2)
        const tesouroIpca = await fetchTaxa(urls.tesouroIpca)
        document.getElementById('tesouro-ipca').value = isNaN(tesouroIpca) ? "N/A" : tesouroIpca.toFixed(2)
        const tr = await fetchTaxa(urls.tr)
        document.getElementById('tr').value = isNaN(tr) ? "N/A" : tr.toFixed(4)
        const poupanca = await fetchTaxa(urls.poupanca)
        document.getElementById('poupanca').value = isNaN(poupanca) ? "N/A" : poupanca.toFixed(4)
        const CDB = 100
        document.getElementById('CDB').value = isNaN(CDB) ? "N/A" : CDB.toFixed(0)
        const tesouroPrefix = 5.50
        document.getElementById('tesouroPrefix').value = isNaN(tesouroPrefix) ? "N/A" : tesouroPrefix.toFixed(2)
        const admDi = 0.25
        document.getElementById('admDi').value = isNaN(admDi) ? "N/A" : admDi.toFixed(2)
        const rentDi = 98.17
        document.getElementById('rentDi').value = isNaN(rentDi) ? "N/A" : rentDi.toFixed(2)

    } catch (error) {
        console.error("Erro ao buscar as taxas de juros:", error)
    }
}


function inicializarGrafico() {
    const ctx = document.getElementById('graficoRendimento').getContext('2d');
    grafico = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Taxa Selic', 'CDI', 'IPCA', 'TR', 'Poupança'],
            datasets: [{
                label: 'Rendimento Estimado (R$)',
                data: [0, 0, 0, 0, 0],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function calcularRendimento() {
            const inicial = parseFloat(document.getElementById('inicial').value) || 0;
            const mensal = parseFloat(document.getElementById('mensal').value) || 0;
            let duracao = parseFloat(document.getElementById('duracao').value) || 0;
            const unidade = document.getElementById('periodo-unidade').value;

            if (unidade === "anos") {
                duracao *= 12;
            }

            const selic = parseFloat(document.getElementById('selic').value) / 100 / 12;
            const cdi = parseFloat(document.getElementById('cdi').value) / 100 / 12;
            const ipca = parseFloat(document.getElementById('ipca').value) / 100;
            const tr = parseFloat(document.getElementById('tr').value) / 100;
            const poupanca = parseFloat(document.getElementById('poupanca').value) / 100;

            const rendimentoSelic = inicial * Math.pow(1 + selic, duracao) + mensal * ((Math.pow(1 + selic, duracao) - 1) / selic);
            const rendimentoCdi = inicial * Math.pow(1 + cdi, duracao) + mensal * ((Math.pow(1 + cdi, duracao) - 1) / cdi);
            const rendimentoIpca = inicial * Math.pow(1 + ipca, duracao) + mensal * ((Math.pow(1 + ipca, duracao) - 1) / ipca);
            const rendimentoTr = inicial * Math.pow(1 + tr, duracao) + mensal * ((Math.pow(1 + tr, duracao) - 1) / tr);
            const rendimentoPoupanca = inicial * Math.pow(1 + poupanca, duracao) + mensal * ((Math.pow(1 + poupanca, duracao) - 1) / poupanca);

            grafico.data.datasets[0].data = [
                rendimentoSelic,
                rendimentoCdi,
                rendimentoIpca,
                rendimentoTr,
                rendimentoPoupanca
            ];
            grafico.update();
        }

        window.onload = function() {
            buscarTaxas();
            inicializarGrafico();
};
                    </script>
                </div>
            </div>
        </div>
    </div>
    </main>
</body>
</html>